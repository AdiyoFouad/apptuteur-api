{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-2">
    <div class="d-flex gap-2 align-items-center mb-3">
        <button class="btn btn-secondary" onclick="window.history.back()">Retour</button>
        <h1>Visites de l'étudiant {{ etudiant.nom }} {{ etudiant.prenom }}</h1>
    </div>
    <div class="d-flex justify-content-between mb-3">
        <a href="{{ path('visite_new', {id: etudiant.id}) }}" class="btn btn-primary">Ajouter une visite</a>
    </div>
    <div class="card ">
        <form method="get" action="?{{ query|merge({'tri': tri, 'statut':statut})|url_encode }}" class="p-2 d-flex align-items-center justify-content-center gap-3">
            <label for="statut">Filtrer par statut :</label>
            <select name="statut" id="statut" class="form-select" style="max-width:200px;">
                <option value="toutes" {% if statut == 'toutes' %}selected{% endif %}>Toutes</option>
                <option value="prévue" {% if statut == 'prévue' %}selected{% endif %}>Prévue</option>
                <option value="réalisée" {% if statut == 'réalisée' %}selected{% endif %}>Réalisée</option>
                <option value="annulée" {% if statut == 'annulée' %}selected{% endif %}>Annulée</option>
            </select>

            <button class="btn btn-primary btn-sm">Filtrer</button>

            
            <div>
                <a href="?{{ query|merge({'tri': 'ASC', 'statut':statut})|url_encode }}" 
                    class="btn btn-outline-secondary btn-sm">
                    Trier ↑
                </a>

                <a href="?{{ query|merge({'tri': 'DESC', 'statut':statut})|url_encode }}" 
                    class="btn btn-outline-secondary btn-sm">
                    Trier ↓
                </a>
            </div>
        </form>
    </div>
    <div class="card">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Commentaire</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for visite in visites %}
                    <tr>
                        <td>{{ visite.date|date('d/m/Y') }}</td>
                        <td>{{ visite.commentaire }}</td>
                        <td>
                            {% if visite.statut == 'prévue' %}
                                <span class="badge bg-primary">{{ visite.statut }}</span>
                            {% elseif visite.statut == 'réalisée' %}
                                <span class="badge bg-success">{{ visite.statut }}</span>
                            {% elseif visite.statut == 'annulée' %}
                                <span class="badge bg-danger">{{ visite.statut }}</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ visite.statut }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ path('visite_edit', {id: visite.id}) }}" class="btn btn-warning btn-sm">Modifier</a>
                            <a href="{{ path('visite_compte_rendu', {id: visite.id}) }}" class="btn btn-info btn-sm">Compte-rendu</a>
                            <a href="{{ path('visite_pdf', {id: visite.id}) }}" class="btn btn-success btn-sm" target="_blank">Exporter en PDF</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
